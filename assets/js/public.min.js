(function ($) {
  "use strict";

  var coverflowSluide = function () {
    var $slider = $(".wpt-coverflow");

    var autoplay = $slider.data("autoplay");
    var loop = $slider.data("loop");

    var swiper = new Swiper(".wpt-coverflow", {
      effect: "coverflow",
      grabCursor: true,
      centeredSlides: true,
      slidesPerView: "auto",
      loop: loop,
      autoplay: {
        delay: autoplay,
        disableOnInteraction: false,
        pauseOnMouseEnter: true,
      },
      coverflowEffect: {
        rotate: 50,
        stretch: 0,
        depth: 100,
        modifier: 1,
        slideShadows: false,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
    });
  };

  var wptaccordion = function () {
    // Open the first item by default
    $(".wpt-accordion-header:first").addClass("active");
    $(".wpt-accordion-content:first").show();
    $(".wpt-accordion-header:first .wpt-accordion-toggle").text("-");

    $(".wpt-accordion-header").click(function () {
      // Close all other items
      $(".wpt-accordion-header").not(this).removeClass("active");
      $(".wpt-accordion-content").not($(this).next()).hide();
      $(".wpt-accordion-header .wpt-accordion-toggle").not(this).text("+");

      // Toggle the clicked item
      $(this).toggleClass("active");
      $(this).next(".wpt-accordion-content").show();

      // Update the toggle icon
      const toggleIcon = $(this).find(".wpt-accordion-toggle");
      if ($(this).hasClass("active")) {
        toggleIcon.text("-");
      } else {
        toggleIcon.text("+");
      }
    });
  };

  // When a speaker item is clicked, load details via AJAX.
  var speakergridpopup = function(){
    $(".speaker-grid").on("click", ".speaker-item", function () {
      var speaker_id = $(this).data("speaker-id");
      $.ajax({
        url: speakerGrid.ajax_url,
        type: "POST",
        data: {
          action: "load_speaker_details",
          speaker_id: speaker_id,
        },
        success: function (response) {
          if (response.success) {
            $("#speaker-details").html(response.data);
            $("#speaker-popup").fadeIn();
          } else {
            alert("Error: " + response.data);
          }
        },
      });
    });

    // Close the popup.
    $("#speaker-popup").on("click", ".close-popup", function () {
      $("#speaker-popup").fadeOut();
    });

    // Close popup when clicking outside the popup content area
    $("#speaker-popup").on("click", function (e) {
      if (!$(e.target).closest(".speaker-popup-content").length) {
        $("#speaker-popup").fadeOut();
      }
    });
  };

  // Package Tab
  var packageTab = function(){
    // Read the package type from the widget container
    var packageType = $('.wpt-package-wrap').data('package-type');

    // Load package tabs via AJAX when the widget is ready
    $.ajax({
        url: packageTabObj.ajax_url,
        method: 'POST',
        data: { 
            action: 'load_package_tabs',
            package_type: packageType
        },
        success: function(response) {
            if ( response.success ) {
                $('.wpt-package-tabs').html( response.data.tabs );
                $('.wpt-package-content').html( response.data.content );
                // Optional: show the first package details by default
                $('.wpt-package-content-item').hide();
                $('.wpt-package-content-item').first().show();
                $('.wpt-tab-item').first().addClass('active');
            }
        }
      });

      // Click event to switch tabs
      $(document).on('click', '.wpt-tab-item', function() {
        var packageID = $(this).data('package');

        $('.wpt-tab-item').removeClass('active');
        $(this).addClass('active');

        $('.wpt-package-content-item').hide();
        $('#package-' + packageID).show();
    });
  };

  $(window).on("elementor/frontend/init", function () {
    elementorFrontend.hooks.addAction(
      "frontend/element_ready/wpt-coverflow-slider-id.default",
      coverflowSluide
    );
  });

  $(window).on("elementor/frontend/init", function () {
    elementorFrontend.hooks.addAction(
      "frontend/element_ready/wpt-accordion-id.default",
      wptaccordion
    );
  });
  
  $(window).on("elementor/frontend/init", function () {
    elementorFrontend.hooks.addAction(
      "frontend/element_ready/wpt-team-card-id.default",
      speakergridpopup
    );
  });

  $(window).on("elementor/frontend/init", function () {
    elementorFrontend.hooks.addAction(
      "frontend/element_ready/wpt-package-tab-id.default",
      packageTab
    );
  });
})(jQuery);
